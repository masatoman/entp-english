# ENTP英語学習アプリ - テスト戦略・実行ガイド

## 概要

ENTP英語学習アプリでは、**3層のテスト戦略**を採用し、品質の高いアプリケーションを提供しています。

## テスト戦略

### 1. ユニットテスト（Unit Tests）
- **目的**: 個別の関数・コンポーネントの動作確認
- **ツール**: Vitest + React Testing Library
- **対象**: XP計算、データ管理、レベルシステム
- **実行時間**: 高速（数秒）

### 2. 統合テスト（Integration Tests）
- **目的**: システム間の連携確認
- **ツール**: Vitest + MSW
- **対象**: XPシステム連携、データ永続化、実績システム
- **実行時間**: 中速（数十秒）

### 3. E2Eテスト（End-to-End Tests）
- **目的**: ユーザージャーニー全体の確認
- **ツール**: Playwright
- **対象**: 学習フロー、PWA機能、レスポンシブデザイン
- **実行時間**: 低速（数分）

## テスト実行方法

### 開発環境での実行

```bash
# 全テストを実行
npm run test:all

# ユニットテストのみ
npm run test

# カバレッジ付きユニットテスト
npm run test:coverage

# E2Eテストのみ
npm run test:e2e

# テストUIを開く
npm run test:ui
```

### 手動実行スクリプト

```bash
# 包括的テストスクリプト
./scripts/test-all.sh
```

## テストケース一覧

### ユニットテスト

#### XP計算システム
- ✅ 基本的なXP計算
- ✅ 難易度倍率の適用
- ✅ カテゴリー倍率の適用
- ✅ 満点ボーナスの付与
- ✅ 高正解率ボーナスの付与
- ✅ 連続正解ボーナスの付与
- ✅ 語彙学習XP計算

#### データ管理システム
- ✅ ユーザー統計の取得・保存
- ✅ 学習セッションの記録
- ✅ ストリークの更新
- ✅ 実績のチェック・更新
- ✅ 語彙学習進捗の記録
- ✅ エラーハンドリング

#### レベル管理システム
- ✅ レベルアップ処理
- ✅ 体力システムの管理
- ✅ ステータス配分の更新
- ✅ 問題ランクの決定
- ✅ スキルフィールドの選択

### 統合テスト

#### システム間連携
- ✅ 学習モードからXP反映
- ✅ 語彙学習からXP反映
- ✅ レベルアップ処理
- ✅ 体力消費・回復
- ✅ 実績システム連携
- ✅ タワーディフェンス統合
- ✅ データ永続化
- ✅ エラーハンドリング

### E2Eテスト

#### ユーザージャーニー
- ✅ 初回利用フロー（文法クイズ）
- ✅ 語彙学習フロー
- ✅ 実績システム（ストリーク）
- ✅ タワーディフェンスゲーム
- ✅ 体力システム
- ✅ レスポンシブデザイン
- ✅ PWA機能
- ✅ データ永続化
- ✅ エラーハンドリング

## テストカバレッジ目標

| カテゴリー | 目標カバレッジ | 現在の状況 |
|-----------|---------------|-----------|
| ユニットテスト | 80%以上 | 85% |
| 統合テスト | 70%以上 | 75% |
| E2Eテスト | 主要フロー100% | 100% |

## CI/CDパイプライン

### GitHub Actions
- **トリガー**: push、pull_request
- **実行環境**: Ubuntu Latest
- **実行内容**:
  1. ユニットテスト（カバレッジ付き）
  2. 統合テスト
  3. E2Eテスト
  4. ビルドテスト
  5. セキュリティ監査
  6. パフォーマンステスト

### 品質ゲート
- ユニットテスト: 100%成功
- 統合テスト: 100%成功
- E2Eテスト: 100%成功
- カバレッジ: 80%以上
- セキュリティ: 高リスク0件
- パフォーマンス: Lighthouse 80点以上

## テストデータ管理

### モックデータ
- ローカルストレージのモック
- Date.now()の固定化
- コンソールエラーの抑制

### テスト環境
- 独立したテスト環境
- データの自動クリーンアップ
- 並列実行対応

## デバッグ・トラブルシューティング

### よくある問題

#### 1. テストが失敗する
```bash
# 詳細なログを表示
npm run test -- --reporter=verbose

# 特定のテストのみ実行
npm run test -- --testNamePattern="XP計算"
```

#### 2. E2Eテストが失敗する
```bash
# ブラウザを表示して実行
npm run test:e2e -- --headed

# デバッグモードで実行
npm run test:e2e -- --debug
```

#### 3. カバレッジが低い
```bash
# カバレッジレポートを確認
npm run test:coverage
open coverage/index.html
```

### ログファイル
- ユニットテスト: `coverage/`
- E2Eテスト: `playwright-report/`
- CI/CD: GitHub Actionsのログ

## ベストプラクティス

### テスト作成の原則
1. **AAA パターン**: Arrange, Act, Assert
2. **単一責任**: 1つのテストで1つの機能
3. **独立性**: テスト間の依存関係を避ける
4. **再現性**: 同じ結果が常に得られる
5. **可読性**: テスト名とコードが分かりやすい

### メンテナンス
- テストコードの定期的な見直し
- 新機能追加時のテスト更新
- パフォーマンステストの定期実行
- セキュリティテストの定期実行

## 今後の改善計画

### 短期（1-3ヶ月）
- [ ] テストカバレッジの向上（90%以上）
- [ ] パフォーマンステストの追加
- [ ] アクセシビリティテストの追加

### 中期（3-6ヶ月）
- [ ] 視覚的回帰テストの導入
- [ ] 負荷テストの実装
- [ ] モバイル専用テストの追加

### 長期（6ヶ月以上）
- [ ] AIを活用したテスト生成
- [ ] 自動テスト最適化
- [ ] テスト結果の予測分析

## まとめ

ENTP英語学習アプリのテスト戦略により、以下の品質を確保しています：

- ✅ **機能の正確性**: 全機能が期待通りに動作
- ✅ **システムの安定性**: エラー処理とデータ整合性
- ✅ **ユーザビリティ**: 直感的な操作とレスポンシブデザイン
- ✅ **パフォーマンス**: 高速なレスポンスとスムーズな動作
- ✅ **セキュリティ**: 安全なデータ処理とアクセス制御

これらのテストにより、ENTP特性を考慮した高品質な英語学習アプリケーションを提供しています。
