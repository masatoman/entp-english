# データ管理システム - ENTP英語学習アプリ

## 概要

ENTP英語学習アプリでは、ローカルストレージベースのデータ管理システムを実装し、ユーザーの学習進捗、実績、統計情報を永続化しています。

## 実装された機能

### 1. 動的データ管理

#### ユーザー統計
- **総XP**: 学習で獲得した経験値の合計
- **連続学習日数**: 現在のストリークと最長記録
- **語彙学習数**: 学習した単語の数
- **文法クイズ完了数**: 完了したクイズの数
- **総問題数**: 回答した問題の総数
- **正解数**: 正解した問題の数
- **平均正解率**: 全体の正解率
- **最終学習日**: 最後に学習した日付

#### 学習履歴
- **セッション記録**: 各学習セッションの詳細
- **成績追跡**: スコア、正解率、学習時間
- **XP獲得記録**: セッションごとのXP獲得量

#### 語彙学習進捗
- **単語別進捗**: 各単語の学習回数と習熟度
- **習熟度レベル**: new, learning, mastered
- **最終学習日**: 各単語の最後の学習日

#### 実績システム
- **動的実績**: ユーザーの進捗に基づく実績の自動更新
- **進捗追跡**: 各実績の現在の進捗状況
- **XP報酬**: 実績達成時のXP獲得

### 2. XP計算システム

#### 基本XP
- **正解**: 10 XP（基本値）
- **不正解**: 0 XP

#### 難易度倍率
- **簡単**: 1.0倍
- **普通**: 1.5倍
- **難しい**: 2.0倍

#### カテゴリー倍率
- **基本文型**: 1.0倍
- **時制**: 1.2倍
- **助動詞**: 1.3倍
- **受動態**: 1.4倍
- **関係詞**: 1.5倍
- **仮定法**: 1.6倍
- **比較**: 1.3倍
- **分詞・動名詞**: 1.4倍
- **不定詞**: 1.5倍

#### ボーナスXP
- **満点ボーナス**: 50 XP
- **高正解率ボーナス**: 25 XP（80%以上）
- **連続正解ボーナス**: 10 XP（3問連続正解）
- **初回正解ボーナス**: 5 XP
- **学習時間ボーナス**: 5-20 XP（学習時間に応じて）

### 3. 実績システム

#### ストリーク実績
- **三日坊主克服**: 3日連続学習（50 XP）
- **一週間戦士**: 7日連続学習（100 XP）
- **継続の力**: 14日連続学習（200 XP）
- **マスターの道**: 30日連続学習（500 XP）

#### 語彙実績
- **単語コレクター**: 50個の単語学習（75 XP）
- **語彙マスター**: 100個の単語学習（150 XP）
- **単語の達人**: 250個の単語学習（300 XP）

#### クイズ実績
- **クイズ初心者**: 10回クイズ完了（60 XP）
- **クイズ愛好家**: 25回クイズ完了（120 XP）

#### スコア実績
- **パーフェクト**: 満点獲得（250 XP）
- **正確性マスター**: 85%以上正解率（180 XP）

## 技術実装

### データ管理クラス

```typescript
// 主要なメソッド
DataManager.getUserStats()           // ユーザー統計の取得
DataManager.saveUserStats(stats)     // ユーザー統計の保存
DataManager.recordLearningSession()  // 学習セッションの記録
DataManager.checkAndUpdateAchievements() // 実績のチェック・更新
DataManager.recordVocabularyStudy()  // 語彙学習の記録
```

### ローカルストレージキー

```typescript
const STORAGE_KEYS = {
  USER_STATS: 'entp-english-user-stats',
  ACHIEVEMENTS: 'entp-english-achievements',
  LEARNING_HISTORY: 'entp-english-learning-history',
  VOCABULARY_PROGRESS: 'entp-english-vocabulary-progress',
};
```

### XP計算関数

```typescript
// 学習セッションのXP計算
calculateTotalSessionXP(userAnswers, difficulty, category, duration)

// 語彙学習のXP計算
calculateVocabularyXP(wordsStudied, difficulty)

// レベル計算
calculateLevel(totalXP)
getXPToNextLevel(totalXP)
getLevelProgress(totalXP)
```

## データフロー

### 1. 学習開始時
1. セッション開始時間を記録
2. 問題・単語をランダム選択

### 2. 学習中
1. 各回答の正誤を記録
2. 語彙学習の場合は単語の学習記録を更新

### 3. 学習完了時
1. セッション時間を計算
2. スコアと正解率を計算
3. XPを計算
4. 学習セッションを記録
5. ユーザー統計を更新
6. 実績をチェック・更新

### 4. データ表示時
1. ローカルストレージから最新データを読み込み
2. 動的に統計情報を表示
3. 実績の進捗状況を表示

## データの永続化

### 自動保存
- 学習セッション完了時に自動保存
- 実績達成時に自動保存
- 語彙学習時に自動保存

### データの整合性
- エラーハンドリングによる安全な保存
- デフォルト値による初期化
- データ形式の検証

### データの復旧
- ローカルストレージエラー時のフォールバック
- データ破損時の初期化
- バックアップ機能（将来実装予定）

## パフォーマンス最適化

### 効率的なデータ操作
- 必要な時のみデータを読み込み
- バッチ処理による複数更新の最適化
- メモリ使用量の最小化

### キャッシュ戦略
- 頻繁にアクセスされるデータのキャッシュ
- 不要なデータの定期的なクリーンアップ

## セキュリティ

### データ保護
- ローカルストレージの適切な使用
- 機密情報の暗号化（将来実装予定）
- データの検証とサニタイゼーション

### プライバシー
- ユーザーデータのローカル保存
- 外部サーバーへの送信なし
- データの完全なユーザー制御

## 今後の拡張予定

### データ同期
- クラウドストレージとの同期
- 複数デバイス間のデータ共有
- オフライン・オンライン同期

### 高度な分析
- 学習パターンの分析
- 弱点の特定と推奨
- 個別化された学習プラン

### ソーシャル機能
- 友達との進捗比較
- ランキングシステム
- 学習グループ機能

## 使用方法

### 開発者向け

```typescript
// ユーザー統計の取得
const stats = DataManager.getUserStats();

// 学習セッションの記録
DataManager.recordLearningSession({
  date: '2024-12-17',
  type: 'grammar-quiz',
  category: 'basic-grammar',
  difficulty: 'normal',
  score: 85,
  totalQuestions: 10,
  correctAnswers: 8,
  xpEarned: 150,
  duration: 300
});

// 実績のチェック
const achievements = DataManager.checkAndUpdateAchievements();
```

### ユーザー向け

1. **学習開始**: アプリを開いて学習モードを選択
2. **学習実行**: 問題に回答または単語を学習
3. **進捗確認**: 実績画面で進捗と統計を確認
4. **継続学習**: ストリークを維持して実績を獲得

## まとめ

動的データ管理システムにより、ENTP英語学習アプリは以下の利点を提供しています：

1. **個人化された学習体験**: ユーザーの進捗に基づく動的な内容
2. **継続的な動機付け**: XPと実績によるゲーミフィケーション
3. **詳細な進捗追跡**: 学習履歴と統計の完全な記録
4. **オフライン対応**: ローカルストレージによる完全なオフライン機能
5. **データの永続化**: ブラウザを閉じても進捗が保持される

これらの機能により、ユーザーは自分のペースで学習を進め、継続的な成長を実感できる環境を提供しています。