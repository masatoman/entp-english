# ENTP英語学習アプリ - Cursor Rules

## プロジェクト概要
ENTP（外向的直感思考知覚）タイプの学習者が飽きずに楽しく英語学習を継続できるProgressive Web App (PWA)。

## 技術スタック
- **フロントエンド**: React 18, TypeScript, Vite
- **スタイリング**: Tailwind CSS, Radix UI
- **PWA**: Vite PWA Plugin, Workbox
- **ゲーム**: タワーディフェンス、クリッカー要素

## 開発方針
- **ユーザー中心設計**: ENTPの特性を理解したUX設計
- **継続的改善**: ユーザーフィードバックに基づく機能追加
- **品質重視**: 型安全性とテストによる品質確保
- **パフォーマンス**: 高速なレスポンスとスムーズな操作感

## コーディング規約

### TypeScript
- 厳密な型チェックを適用
- インターフェースは明確に定義
- 型の安全性を最優先

### React
- 関数コンポーネントを使用
- カスタムフックでロジックを分離
- プロップスの型定義を必須とする
- 不要な再レンダリングを避ける

### スタイリング
- Tailwind CSSのユーティリティクラスを使用
- レスポンシブデザインを必須とする
- アクセシビリティを考慮したスタイリング

## ファイル構造
```
src/
├── components/           # Reactコンポーネント
│   ├── ui/              # 再利用可能なUIコンポーネント
│   ├── Home.tsx         # ホーム画面
│   ├── VocabularyCard.tsx # 語彙学習
│   ├── GrammarQuiz.tsx  # 文法クイズ
│   ├── CombinedTest.tsx # 総合テスト
│   ├── TimeAttackMode.tsx # タイムアタックモード
│   ├── SimpleTowerDefense.tsx # タワーディフェンスゲーム
│   ├── Achievements.tsx # 実績画面
│   ├── PWAInstallPrompt.tsx # PWAインストールプロンプト
│   ├── PWAUpdatePrompt.tsx # PWA更新プロンプト
│   └── ...
├── data/                # データファイル
│   ├── questions.ts     # 問題データ
│   ├── vocabulary.ts    # 語彙データ
│   ├── achievements.ts  # 実績データ
│   ├── combinedTest.ts  # 総合テストデータ
│   ├── xpShop.ts        # XPショップデータ
│   └── ...
├── types/               # TypeScript型定義
│   ├── index.ts         # 基本型定義
│   └── simple-game.ts   # ゲーム関連型定義
├── utils/               # ユーティリティ関数
│   ├── dataManager.ts   # データ管理
│   ├── xpCalculator.ts  # XP計算
│   ├── tower-defense-data.ts # ゲームデータ
│   └── ...
├── styles/              # スタイルファイル
│   └── globals.css
├── App.tsx              # メインアプリケーション
└── main.tsx             # エントリーポイント
```

## データ管理ルール

### 問題データ
- `src/data/questions.ts` の更新時は型定義も確認
- カテゴリーと難易度の一貫性を保つ
- 問題文、正解、解説の品質を維持

### 語彙データ
- カテゴリー分類の一貫性を保つ
- レベル（beginner/intermediate/advanced）の適切な分類
- 例文と例文訳の品質を維持

### 実績データ
- XP計算ロジックとの整合性を確認
- アチーブメントの要件を明確に定義
- 進捗追跡の正確性を保つ

## コンポーネント設計ルール

### 単一責任の原則
- 各コンポーネントは明確な役割を持つ
- ロジックは適切に分離する
- 再利用性を考慮した設計

### 状態管理
- データの流れを一方向に保つ
- 不要な状態の更新を避ける
- 適切な状態の持ち場所を選択

### エラーハンドリング
- 適切なエラーメッセージを表示
- ユーザーフレンドリーなエラー処理
- デバッグ情報の適切な管理

## パフォーマンスルール

### 最適化
- 不要な再レンダリングを避ける
- 適切なメモ化を使用
- バンドルサイズを監視

### 読み込み
- 遅延読み込みを適切に使用
- 画像の最適化
- コード分割の活用

## アクセシビリティルール

### WCAG 2.1 AA準拠
- 適切なコントラスト比
- キーボード操作の対応
- スクリーンリーダーの対応

### ユーザビリティ
- 直感的なナビゲーション
- 明確なフィードバック
- エラーの防止と修正

## PWA機能ルール

### インストール
- 適切なインストールプロンプト
- マニフェストの正確性
- アイコンの品質

### オフライン対応
- 適切なキャッシュ戦略
- オフライン時の適切な表示
- データの同期

## ゲーム機能ルール

### タワーディフェンス
- ゲームバランスの調整
- ユーザー体験の最適化
- パフォーマンスの維持

### XPシステム
- 適切なXP計算
- バランスの取れた報酬
- 進捗の可視化

## テストルール

### 必須テスト
- 機能テスト
- 回帰テスト
- ユーザビリティテスト

### テスト対象
- 主要機能の動作確認
- エラーハンドリング
- パフォーマンス

### E2Eテスト（MCP Playwright Server必須）
- **MCP Playwright Serverを使用**: 全てのE2EテストはMCPサーバー経由で実行
- **ブラウザ操作**: MCPサーバー経由でブラウザ操作を実行
- **安定性**: より安定したテスト実行環境を提供
- **デバッグ**: リモートブラウザ操作とデバッグ機能の強化
- **実行コマンド**: `npm run test:e2e:mcp` でMCPサーバー経由のテストを実行

## ドキュメントルール

### 更新必須
- 仕様変更時は必ずドキュメントを更新
- 実装状況の正確な反映
- 進捗状況の適切な管理

### 優先順位
1. **最優先**: `overview.md` - プロジェクト全体の整合性
2. **高優先**: `tech-specs.md` - 技術仕様の正確性
3. **中優先**: `timeline.md` - 進捗状況の反映
4. **低優先**: その他の詳細ドキュメント

## コミット・プッシュルール

### コミット前チェック
- [ ] 動作確認（手動テスト）
- [ ] エラーハンドリングの確認
- [ ] レスポンシブデザインの確認
- [ ] アクセシビリティの確認
- [ ] ドキュメントの更新

### コミットメッセージ
- 変更内容を明確に記述
- 影響範囲を明示
- 関連するIssueやタスクを参照

## 緊急時対応ルール

### バグ発見時
1. 問題の再現と影響範囲の特定
2. 緊急度の判定（高・中・低）
3. 一時的な回避策の実装
4. 根本原因の調査と修正
5. ドキュメントの更新

### 緊急度別対応
- **高**: 即座に対応（学習機能の停止など）
- **中**: 24時間以内に対応
- **低**: 次回リリース時に修正

## ENTP特性を考慮した設計

### 多様性
- 定期的な新機能・新コンテンツの追加
- 異なる学習モードの提供
- カスタマイズオプションの拡充

### 即効性
- 即座のフィードバック
- 達成感の提供
- 進捗の可視化

### 自由度
- 学習順序の自由選択
- カスタマイズ可能な設定
- 柔軟な学習環境

## 新チャット開始時の確認事項

新しいチャットセッションを開始する際は、以下を確認してください：

1. **プロジェクト状況の確認**: `docs/project-snapshot.md`
2. **開発フローの確認**: `docs/development-workflow.md`
3. **技術スタックの確認**: `docs/tech-specs.md`

## 注意事項

- このプロジェクトはENTP特性を考慮した設計が重要
- 品質とパフォーマンスを最優先とする
- ユーザー体験の継続的改善を心がける
- ドキュメントの整合性を保つ
- テストの重要性を理解する
