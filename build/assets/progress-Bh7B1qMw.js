import{r as f,j as s}from"./ui-C48fKjuK.js";import{B as R,C as S,a as h,c as _,P as T,b as v}from"./game-DhYA9e1X.js";import{A as C,T as b,F as I,a as j,S as N}from"./learning-CJqkZPhv.js";const O="modulepreload",L=function(r){return"/"+r},A={},D=function(e,t,a){let l=Promise.resolve();if(t&&t.length>0){let n=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),m=o?.nonce||o?.getAttribute("nonce");l=n(t.map(u=>{if(u=L(u),u in A)return;A[u]=!0;const d=u.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${p}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":O,d||(g.as="script"),g.crossOrigin="",g.href=u,m&&g.setAttribute("nonce",m),document.head.appendChild(g),d)return new Promise((k,U)=>{g.addEventListener("load",k),g.addEventListener("error",()=>U(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(n){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n}return l.then(n=>{for(const o of n||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},c={USER_STATS:"entp-english-user-stats",ACHIEVEMENTS:"entp-english-achievements",LEARNING_HISTORY:"entp-english-learning-history",VOCABULARY_PROGRESS:"entp-english-vocabulary-progress",APP_SETTINGS:"entp-english-app-settings"},F={totalXP:0,currentStreak:0,longestStreak:0,vocabularyStudied:0,grammarQuizzesCompleted:0,totalQuestionsAnswered:0,correctAnswers:0,averageScore:0,lastStudyDate:new Date().toISOString().split("T")[0],todayXP:0,totalStudyTime:0,accuracy:0,streakDays:0},w={dailyXPGoal:100,grammarQuizQuestionCount:10,vocabularyQuestionCount:10,essayQuestionCount:10};class y{static getUserStats(){try{const e=localStorage.getItem(c.USER_STATS);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load user stats:",e)}return F}static saveUserStats(e){try{localStorage.setItem(c.USER_STATS,JSON.stringify(e))}catch(t){console.error("Failed to save user stats:",t)}}static getLearningHistory(){try{const e=localStorage.getItem(c.LEARNING_HISTORY);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load learning history:",e)}return[]}static saveLearningHistory(e){try{localStorage.setItem(c.LEARNING_HISTORY,JSON.stringify(e))}catch(t){console.error("Failed to save learning history:",t)}}static getVocabularyProgress(){try{const e=localStorage.getItem(c.VOCABULARY_PROGRESS);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load vocabulary progress:",e)}return[]}static saveVocabularyProgress(e){try{localStorage.setItem(c.VOCABULARY_PROGRESS,JSON.stringify(e))}catch(t){console.error("Failed to save vocabulary progress:",t)}}static getAchievements(){try{const e=localStorage.getItem(c.ACHIEVEMENTS);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load achievements:",e)}return[]}static saveAchievements(e){try{localStorage.setItem(c.ACHIEVEMENTS,JSON.stringify(e))}catch(t){console.error("Failed to save achievements:",t)}}static recordLearningSession(e){const t=this.getLearningHistory(),a={...e,id:`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};t.unshift(a),this.saveLearningHistory(t),this.updateUserStatsFromSession(a)}static updateUserStatsFromSession(e){const t=this.getUserStats(),a=new Date().toISOString().split("T")[0],l=new Date(Date.now()-1440*60*1e3).toISOString().split("T")[0];t.totalXP+=e.xpEarned,t.totalQuestionsAnswered+=e.totalQuestions,t.correctAnswers+=e.correctAnswers,t.averageScore=Math.round(t.correctAnswers/t.totalQuestionsAnswered*100),e.type==="vocabulary"?t.vocabularyStudied+=1:e.type==="grammar-quiz"&&(t.grammarQuizzesCompleted+=1),console.log("Streak calculation:",{lastStudyDate:t.lastStudyDate,today:a,yesterday:l,currentStreak:t.currentStreak}),t.lastStudyDate===a?console.log("Already studied today, streak unchanged"):t.lastStudyDate===l?(t.currentStreak+=1,console.log("Streak continued:",t.currentStreak)):(t.currentStreak=1,console.log("Streak reset to 1")),t.currentStreak>t.longestStreak&&(t.longestStreak=t.currentStreak),t.lastStudyDate=a,this.saveUserStats(t),this.sendNotifications(t)}static async sendNotifications(e){try{const{notificationManager:t}=await D(async()=>{const{notificationManager:a}=await import("./notificationManager-DRqVOwDk.js");return{notificationManager:a}},[]);e.currentStreak>1&&await t.showStreakReminder(e.currentStreak)}catch(t){console.error("Error sending notifications:",t)}}static recordVocabularyStudy(e){const t=this.getVocabularyProgress(),a=t.find(i=>i.wordId===e),l=new Date().toISOString().split("T")[0];a?(a.studiedCount+=1,a.lastStudied=l,a.studiedCount>=5?a.masteryLevel="mastered":a.studiedCount>=2&&(a.masteryLevel="learning")):t.push({wordId:e,studiedCount:1,lastStudied:l,masteryLevel:"new"}),this.saveVocabularyProgress(t)}static checkAndUpdateAchievements(){const e=this.getUserStats(),t=this.getLearningHistory(),a=this.getVocabularyProgress();let l=this.getAchievements();return l.length===0&&(l=this.initializeAchievements()),l.forEach(i=>{let n=0,o=i.requirement;switch(i.type){case"streak":i.id.includes("current")?n=e.currentStreak:i.id.includes("longest")&&(n=e.longestStreak);break;case"vocabulary":n=a.length;break;case"grammar":case"quiz":n=e.grammarQuizzesCompleted;break;case"score":i.id==="perfect_score"?n=t.filter(m=>m.score===100).length:i.id==="high_accuracy"&&(n=t.filter(m=>m.score>=85).length);break}i.progress=Math.min(n,o),i.maxProgress=o,n>=o&&!i.isUnlocked&&(i.isUnlocked=!0,e.totalXP+=i.xpReward)}),this.saveAchievements(l),this.saveUserStats(e),l}static initializeAchievements(){return[{id:"streak_3",title:"三日坊主克服",description:"3日連続で学習",icon:"🔥",type:"streak",tier:"bronze",requirement:3,xpReward:50,isUnlocked:!1,progress:0,maxProgress:3},{id:"streak_7",title:"一週間戦士",description:"7日連続で学習",icon:"⚡",type:"streak",tier:"silver",requirement:7,xpReward:100,isUnlocked:!1,progress:0,maxProgress:7},{id:"streak_14",title:"継続の力",description:"14日連続で学習",icon:"🌟",type:"streak",tier:"gold",requirement:14,xpReward:200,isUnlocked:!1,progress:0,maxProgress:14},{id:"streak_30",title:"マスターの道",description:"30日連続で学習",icon:"👑",type:"streak",tier:"platinum",requirement:30,xpReward:500,isUnlocked:!1,progress:0,maxProgress:30},{id:"vocab_50",title:"単語コレクター",description:"50個の単語を学習",icon:"📚",type:"vocabulary",tier:"bronze",requirement:50,xpReward:75,isUnlocked:!1,progress:0,maxProgress:50},{id:"vocab_100",title:"語彙マスター",description:"100個の単語を学習",icon:"🎓",type:"vocabulary",tier:"silver",requirement:100,xpReward:150,isUnlocked:!1,progress:0,maxProgress:100},{id:"vocab_250",title:"単語の達人",description:"250個の単語を学習",icon:"🏆",type:"vocabulary",tier:"gold",requirement:250,xpReward:300,isUnlocked:!1,progress:0,maxProgress:250},{id:"quiz_10",title:"クイズ初心者",description:"10回文法クイズを完了",icon:"🧩",type:"quiz",tier:"bronze",requirement:10,xpReward:60,isUnlocked:!1,progress:0,maxProgress:10},{id:"quiz_25",title:"クイズ愛好家",description:"25回文法クイズを完了",icon:"🎯",type:"quiz",tier:"silver",requirement:25,xpReward:120,isUnlocked:!1,progress:0,maxProgress:25},{id:"perfect_score",title:"パーフェクト",description:"満点を獲得",icon:"💯",type:"score",tier:"gold",requirement:1,xpReward:250,isUnlocked:!1,progress:0,maxProgress:1},{id:"high_accuracy",title:"正確性マスター",description:"正解率85%以上を達成",icon:"🎖️",type:"score",tier:"silver",requirement:1,xpReward:180,isUnlocked:!1,progress:0,maxProgress:1}]}static resetAllData(){localStorage.removeItem(c.USER_STATS),localStorage.removeItem(c.ACHIEVEMENTS),localStorage.removeItem(c.LEARNING_HISTORY),localStorage.removeItem(c.VOCABULARY_PROGRESS),localStorage.removeItem(c.APP_SETTINGS)}static exportData(){const e={userStats:this.getUserStats(),achievements:this.getAchievements(),learningHistory:this.getLearningHistory(),vocabularyProgress:this.getVocabularyProgress(),appSettings:this.getAppSettings(),exportDate:new Date().toISOString()};return JSON.stringify(e,null,2)}static importData(e){try{const t=JSON.parse(e);return t.userStats&&this.saveUserStats(t.userStats),t.achievements&&this.saveAchievements(t.achievements),t.learningHistory&&this.saveLearningHistory(t.learningHistory),t.vocabularyProgress&&this.saveVocabularyProgress(t.vocabularyProgress),t.appSettings&&this.saveAppSettings(t.appSettings),!0}catch(t){return console.error("Failed to import data:",t),!1}}static getAppSettings(){try{const e=localStorage.getItem(c.APP_SETTINGS);if(e){const t=JSON.parse(e);return{...w,...t}}}catch(e){console.error("Error loading app settings:",e)}return w}static saveAppSettings(e){try{const a={...this.getAppSettings(),...e};localStorage.setItem(c.APP_SETTINGS,JSON.stringify(a))}catch(t){console.error("Error saving app settings:",t)}}}const x={BASE_CORRECT_ANSWER:10,DIFFICULTY_MULTIPLIER:{easy:1,normal:1.5,hard:2},CATEGORY_MULTIPLIER:{"basic-grammar":1,tenses:1.2,modals:1.3,passive:1.4,relative:1.5,subjunctive:1.6,comparison:1.3,participle:1.4,infinitive:1.5},PERFECT_SCORE_BONUS:50,HIGH_ACCURACY_BONUS:25,STREAK_BONUS:10,FIRST_ATTEMPT_BONUS:5};function H(r,e,t,a=!1){let l=0,i=0,n=0;r.forEach((m,u)=>{if(m.isCorrect){i++,n++;let d=x.BASE_CORRECT_ANSWER;d*=x.DIFFICULTY_MULTIPLIER[e],d*=x.CATEGORY_MULTIPLIER[t],a&&(d+=x.FIRST_ATTEMPT_BONUS),n>=3&&(d+=x.STREAK_BONUS),l+=Math.round(d)}else n=0});const o=i/r.length*100;return o===100?l+=x.PERFECT_SCORE_BONUS:o>=80&&(l+=x.HIGH_ACCURACY_BONUS),l}function Y(r,e){const a={beginner:1,intermediate:1.5,advanced:2};return Math.round(r*5*a[e])}function M(r){const e=r/60;return e>=30?20:e>=15?10:e>=5?5:0}function $(r,e,t,a,l=!1){const i=H(r,e,t,l),n=M(a);return i+n}function z(r){switch(r){case"bronze":return"from-amber-600 to-yellow-600";case"silver":return"from-gray-400 to-gray-600";case"gold":return"from-yellow-400 to-yellow-600";case"platinum":return"from-purple-400 to-purple-600";case"diamond":return"from-blue-400 to-cyan-400";default:return"from-gray-300 to-gray-500"}}function q(r){switch(r){case"bronze":return"text-amber-700";case"silver":return"text-gray-700";case"gold":return"text-yellow-700";case"platinum":return"text-purple-700";case"diamond":return"text-cyan-700";default:return"text-gray-700"}}function P({achievement:r}){const e=r.progress/r.maxProgress*100,t=z(r.tier),a=q(r.tier);return s.jsxs(S,{className:`
      relative overflow-hidden transition-all duration-300 border-2
      ${r.isUnlocked?"border-emerald-200 bg-gradient-to-br from-emerald-50 to-white shadow-lg":"border-gray-200 bg-gradient-to-br from-gray-50 to-white"}
    `,children:[r.isUnlocked&&s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full animate-pulse"})}),s.jsx(_,{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`
              text-3xl p-2 rounded-full bg-gradient-to-br ${t}
              ${r.isUnlocked?"opacity-100":"opacity-50 grayscale"}
            `,children:r.icon}),s.jsxs("div",{children:[s.jsx("h3",{className:`font-medium ${r.isUnlocked?"text-gray-900":"text-gray-500"}`,children:r.title}),s.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]})]}),s.jsx(v,{variant:r.isUnlocked?"default":"secondary",className:`text-xs ${r.isUnlocked?a:""}`,children:r.tier.toUpperCase()})]})}),s.jsxs(h,{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"進捗"}),s.jsxs("span",{className:r.isUnlocked?"text-emerald-600 font-medium":"text-muted-foreground",children:[r.progress," / ",r.maxProgress]})]}),s.jsx(T,{value:e,className:`h-2 ${r.isUnlocked?"":"opacity-50"}`}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center space-x-1 text-sm",children:[s.jsx(N,{className:"w-4 h-4 text-yellow-500"}),s.jsxs("span",{className:"text-muted-foreground",children:[r.xpReward," XP"]})]}),r.isUnlocked&&s.jsx(v,{variant:"outline",className:"text-xs text-emerald-600",children:"獲得済み"})]})]})]})}function E({icon:r,label:e,value:t,color:a}){return s.jsx(S,{className:"bg-gradient-to-br from-white to-gray-50 border-0 shadow-md",children:s.jsxs(h,{className:"p-4 text-center",children:[s.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-full bg-gradient-to-br ${a} mb-3`,children:s.jsx(r,{className:"w-6 h-6 text-foreground"})}),s.jsx("div",{className:"text-2xl font-semibold mb-1",children:t}),s.jsx("div",{className:"text-sm text-muted-foreground",children:e})]})})}function B({onBack:r}){const[e,t]=f.useState(y.getUserStats()),[a,l]=f.useState([]);f.useEffect(()=>{const o=y.getUserStats(),m=y.getAchievements();t(o),l(m)},[]);const i=a.filter(o=>o.isUnlocked),n=a.filter(o=>!o.isUnlocked);return s.jsx("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white",children:s.jsxs("div",{className:"max-w-md mx-auto p-4 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between pt-8",children:[s.jsx(R,{variant:"ghost",onClick:r,className:"p-2",children:s.jsx(C,{className:"w-5 h-5"})}),s.jsx("h1",{className:"text-xl",children:"実績"}),s.jsx("div",{className:"w-10"})]}),s.jsx(S,{className:"bg-gradient-to-br from-blue-600 to-purple-600 text-foreground border-0 shadow-xl",children:s.jsxs(h,{className:"p-6 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center mb-3",children:[s.jsx(b,{className:"w-8 h-8 mr-2"}),s.jsx("span",{className:"text-lg",children:"合計XP"})]}),s.jsx("div",{className:"text-5xl font-bold mb-2",children:e.totalXP.toLocaleString()}),s.jsx("div",{className:"text-blue-100",children:"継続は力なり！"})]})}),s.jsx(S,{className:"bg-gradient-to-br from-orange-500 to-red-500 text-foreground border-0 shadow-lg",children:s.jsx(h,{className:"p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"p-3 bg-white/20 rounded-full",children:s.jsx(I,{className:"w-6 h-6"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm opacity-90",children:"連続学習"}),s.jsxs("div",{className:"text-2xl font-bold",children:[e.currentStreak,"日"]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm opacity-90",children:"最長記録"}),s.jsxs("div",{className:"text-lg font-medium",children:[e.longestStreak,"日"]})]})]})})}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(E,{icon:j,label:"正解率",value:`${e.averageScore}%`,color:"from-emerald-500 to-green-600"}),s.jsx(E,{icon:N,label:"総問題数",value:e.totalQuestionsAnswered,color:"from-yellow-500 to-orange-500"})]}),s.jsxs(S,{className:"border-0 shadow-md",children:[s.jsx(_,{className:"pb-3",children:s.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[s.jsx(b,{className:"w-5 h-5 mr-2 text-yellow-600"}),"実績進捗"]})}),s.jsxs(h,{children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"獲得済み"}),s.jsxs("span",{className:"font-medium",children:[i.length," / ",a.length]})]}),s.jsx(T,{value:i.length/a.length*100,className:"h-3"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[s.jsx(N,{className:"w-5 h-5 mr-2 text-emerald-600"}),"獲得済み実績 (",i.length,")"]}),s.jsx("div",{className:"space-y-3",children:i.map(o=>s.jsx(P,{achievement:o},o.id))})]}),n.length>0&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[s.jsx(j,{className:"w-5 h-5 mr-2 text-gray-500"}),"未獲得実績 (",n.length,")"]}),s.jsx("div",{className:"space-y-3",children:n.map(o=>s.jsx(P,{achievement:o},o.id))})]}),s.jsx("div",{className:"h-8"})]})})}const J=Object.freeze(Object.defineProperty({__proto__:null,Achievements:B},Symbol.toStringTag,{value:"Module"}));export{J as A,y as D,D as _,$ as a,Y as c};
