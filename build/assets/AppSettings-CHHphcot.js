import{r as n,u as J,w as ie,j as e,f as ce,d as K,h as le,z as oe}from"./ui-DhiIzcP4.js";import{B,C as y,d as D,g as L,h as U,a as w}from"./game-DQXwOTYN.js";import{u as de,S as X,a as _,b as M,d as z,e as t,L as C}from"./index-BMpfVX6s.js";import{d as q,q as A,a as me,z as V,J as he,K as G,x as xe,L as ue,M as je,N as $,m as pe}from"./learning-B7AfTcwU.js";import{notificationManager as f}from"./notificationManager-DRqVOwDk.js";import{D as k}from"./progress-Dp2NNpON.js";import"./vendor-D3F3s8fL.js";var F="Switch",[fe,Ee]=ce(F),[ge,ve]=fe(F),W=n.forwardRef((l,r)=>{const{__scopeSwitch:i,name:a,checked:o,defaultChecked:c,required:m,disabled:h,value:p="on",onCheckedChange:g,form:d,...R}=l,[v,b]=n.useState(null),E=J(r,S=>b(S)),x=n.useRef(!1),u=v?d||!!v.closest("form"):!0,[N,O]=ie({prop:o,defaultProp:c??!1,onChange:g,caller:F});return e.jsxs(ge,{scope:i,checked:N,disabled:h,children:[e.jsx(K.button,{type:"button",role:"switch","aria-checked":N,"aria-required":m,"data-state":se(N),"data-disabled":h?"":void 0,disabled:h,value:p,...R,ref:E,onClick:le(l.onClick,S=>{O(H=>!H),u&&(x.current=S.isPropagationStopped(),x.current||S.stopPropagation())})}),u&&e.jsx(ee,{control:v,bubbles:!x.current,name:a,value:p,checked:N,required:m,disabled:h,form:d,style:{transform:"translateX(-100%)"}})]})});W.displayName=F;var Y="SwitchThumb",Z=n.forwardRef((l,r)=>{const{__scopeSwitch:i,...a}=l,o=ve(Y,i);return e.jsx(K.span,{"data-state":se(o.checked),"data-disabled":o.disabled?"":void 0,...a,ref:r})});Z.displayName=Y;var be="SwitchBubbleInput",ee=n.forwardRef(({__scopeSwitch:l,control:r,checked:i,bubbles:a=!0,...o},c)=>{const m=n.useRef(null),h=J(m,c),p=de(i),g=oe(r);return n.useEffect(()=>{const d=m.current;if(!d)return;const R=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(R,"checked").set;if(p!==i&&b){const E=new Event("click",{bubbles:a});b.call(d,i),d.dispatchEvent(E)}},[p,i,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...o,tabIndex:-1,ref:h,style:{...o.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ee.displayName=be;function se(l){return l?"checked":"unchecked"}var te=W,Ne=Z;const P=n.forwardRef(({className:l,...r},i)=>e.jsx(te,{className:q("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",l),...r,ref:i,children:e.jsx(Ne,{className:q("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));P.displayName=te.displayName;function Te({onBack:l}){const[r,i]=n.useState({dailyXPGoal:100,grammarQuizQuestionCount:10,vocabularyQuestionCount:10,essayQuestionCount:10}),[a,o]=n.useState(f.getSettings()),[c,m]=n.useState(f.getPermissionStatus()),[h,p]=n.useState(!1),[g,d]=n.useState(!1),[R,v]=n.useState(A.getEnabled());n.useEffect(()=>{b(),p(f.isSupported()),m(f.getPermissionStatus())},[]);const b=()=>{const s=k.getAppSettings();i(s)},E=s=>{const j={...r,...s};i(j),k.saveAppSettings(j)},x=(s,j)=>{E({[s]:j})},u=(s,j)=>{const T={...a,[s]:j};o(T),f.updateSettings(T)},N=s=>{v(s),A.setEnabled(s),s&&A.sounds.click()},O=async()=>{try{const s=await f.requestPermission();m(s)}catch(s){console.error("Error requesting permission:",s),alert("通知の許可を取得できませんでした。ブラウザの設定を確認してください。")}},S=async()=>{if(c!=="granted"){alert("通知の許可が必要です。");return}d(!0);try{await f.testNotification()}catch(s){console.error("Error showing test notification:",s),alert("テスト通知の表示に失敗しました。")}finally{d(!1)}},Q=(()=>{switch(c){case"granted":return{text:"許可済み",color:"text-green-600",icon:pe};case"denied":return{text:"拒否済み",color:"text-red-600",icon:$};default:return{text:"未設定",color:"text-yellow-600",icon:G}}})(),ae=Q.icon,ne=()=>{confirm("すべての学習データを削除しますか？この操作は取り消せません。")&&confirm("本当に削除しますか？")&&(localStorage.clear(),window.location.reload())},re=()=>{try{const s={userStats:k.getUserStats(),learningHistory:k.getLearningHistory(),achievements:k.getAchievements(),vocabularyProgress:k.getVocabularyProgress(),appSettings:r,notificationSettings:a,exportDate:new Date().toISOString()},j=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),T=URL.createObjectURL(j),I=document.createElement("a");I.href=T,I.download=`entp-english-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(T)}catch(s){console.error("Error exporting data:",s),alert("データのエクスポートに失敗しました。")}};return e.jsx("div",{className:"min-h-screen p-4 flex flex-col justify-center",children:e.jsxs("div",{className:"max-w-md mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{variant:"ghost",onClick:l,className:"p-2",children:"←"}),e.jsx("h1",{className:"text-2xl font-bold",children:"アプリ設定"}),e.jsx("div",{className:"w-10"})]}),e.jsxs(y,{children:[e.jsxs(D,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"学習設定"]}),e.jsx(U,{children:"学習目標をカスタマイズできます"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"1日のXP目標"}),e.jsxs(X,{value:r.dailyXPGoal.toString(),onValueChange:s=>x("dailyXPGoal",parseInt(s)),children:[e.jsx(_,{children:e.jsx(M,{})}),e.jsxs(z,{children:[e.jsx(t,{value:"50",children:"50 XP"}),e.jsx(t,{value:"100",children:"100 XP"}),e.jsx(t,{value:"150",children:"150 XP"}),e.jsx(t,{value:"200",children:"200 XP"}),e.jsx(t,{value:"300",children:"300 XP"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ホーム画面の進捗バーに反映されます"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"文法クイズの問題数"}),e.jsxs(X,{value:r.grammarQuizQuestionCount.toString(),onValueChange:s=>x("grammarQuizQuestionCount",parseInt(s)),children:[e.jsx(_,{children:e.jsx(M,{})}),e.jsxs(z,{children:[e.jsx(t,{value:"5",children:"5問"}),e.jsx(t,{value:"10",children:"10問"}),e.jsx(t,{value:"15",children:"15問"}),e.jsx(t,{value:"20",children:"20問"}),e.jsx(t,{value:"25",children:"25問"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"文法クイズで出題される問題数を設定します"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"語彙学習の問題数"}),e.jsxs(X,{value:r.vocabularyQuestionCount.toString(),onValueChange:s=>x("vocabularyQuestionCount",parseInt(s)),children:[e.jsx(_,{children:e.jsx(M,{})}),e.jsxs(z,{children:[e.jsx(t,{value:"5",children:"5問"}),e.jsx(t,{value:"10",children:"10問"}),e.jsx(t,{value:"15",children:"15問"}),e.jsx(t,{value:"20",children:"20問"}),e.jsx(t,{value:"25",children:"25問"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"語彙学習で出題される問題数を設定します"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"英作文の問題数"}),e.jsxs(X,{value:r.essayQuestionCount.toString(),onValueChange:s=>x("essayQuestionCount",parseInt(s)),children:[e.jsx(_,{children:e.jsx(M,{})}),e.jsxs(z,{children:[e.jsx(t,{value:"5",children:"5問"}),e.jsx(t,{value:"10",children:"10問"}),e.jsx(t,{value:"15",children:"15問"}),e.jsx(t,{value:"20",children:"20問"}),e.jsx(t,{value:"25",children:"25問"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"英作文で出題される問題数を設定します"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{htmlFor:"sound-enabled",children:"効果音を有効にする"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"操作時の効果音を有効/無効にします"})]}),e.jsx(P,{id:"sound-enabled",checked:R,onCheckedChange:N})]})]})]}),e.jsxs(y,{children:[e.jsxs(D,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"データ管理"]}),e.jsx(U,{children:"学習データのバックアップと管理"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs(B,{onClick:re,variant:"outline",className:"w-full",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"データをエクスポート"]}),e.jsxs(B,{onClick:ne,variant:"destructive",className:"w-full",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"すべてのデータを削除"]})]})]}),h?e.jsxs(e.Fragment,{children:[e.jsxs(y,{children:[e.jsx(D,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"通知の許可状況"]})}),e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:`w-5 h-5 ${Q.color}`}),e.jsx("span",{className:Q.color,children:Q.text})]}),c!=="granted"&&e.jsx(B,{onClick:O,size:"sm",children:"許可をリクエスト"})]}),c==="denied"&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"通知が拒否されています。ブラウザの設定から許可してください。"})]})]}),e.jsxs(y,{children:[e.jsxs(D,{children:[e.jsx(L,{children:"通知設定"}),e.jsx(U,{children:"学習のリマインダーや実績通知を設定できます"})]}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{htmlFor:"enable-notifications",children:"通知を有効にする"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"すべての通知機能を有効/無効にします"})]}),e.jsx(P,{id:"enable-notifications",checked:a.enabled,onCheckedChange:s=>u("enabled",s),disabled:c!=="granted"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{htmlFor:"daily-reminder",children:"毎日の学習リマインダー"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"指定した時間に学習を促す通知を送信します"})]}),e.jsx(P,{id:"daily-reminder",checked:a.dailyReminder,onCheckedChange:s=>u("dailyReminder",s),disabled:!a.enabled||c!=="granted"})]}),a.dailyReminder&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(C,{htmlFor:"reminder-time",children:"通知時間"}),e.jsx(ue,{id:"reminder-time",type:"time",value:a.reminderTime,onChange:s=>u("reminderTime",s.target.value),className:"w-32"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{htmlFor:"streak-reminder",children:"連続学習記録通知"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"連続学習記録が更新された時に通知します"})]}),e.jsx(P,{id:"streak-reminder",checked:a.streakReminder,onCheckedChange:s=>u("streakReminder",s),disabled:!a.enabled||c!=="granted"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{htmlFor:"achievement-reminder",children:"実績解除通知"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"新しい実績を獲得した時に通知します"})]}),e.jsx(P,{id:"achievement-reminder",checked:a.achievementReminder,onCheckedChange:s=>u("achievementReminder",s),disabled:!a.enabled||c!=="granted"})]})]})]}),e.jsx(y,{children:e.jsxs(w,{className:"pt-6",children:[e.jsxs(B,{onClick:S,disabled:c!=="granted"||g,className:"w-full",variant:"outline",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),g?"テスト中...":"テスト通知を送信"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center mt-2",children:"通知が正常に動作するかテストできます"})]})})]}):e.jsx(y,{children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx($,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"通知機能が利用できません"}),e.jsx("p",{className:"text-sm text-gray-600",children:"お使いのブラウザは通知機能をサポートしていません。"})]})})})]})})}export{Te as AppSettings};
