import{r as n,u as J,v as ie,j as e,e as ce,c as W,g as le,y as oe}from"./ui-smpf69Zd.js";import{u as de,b as me,B,C as y,f as X,h as _,j as A,d as w}from"./game-Dd6Kb0LE.js";import{D as C}from"./progress-BPWR83xl.js";import{notificationManager as f}from"./notificationManager-DRqVOwDk.js";import{c as V,x as H,a as ue,X as q,Y as he,_ as $,l as xe,I as je,$ as pe,a0 as G,t as fe}from"./learning-B-E1ZIuS.js";import{u as ge,b as D,c as L,d as F,e as M,f as t,L as k}from"./index-CPlkK9WN.js";import"./vendor-D3F3s8fL.js";var O="Switch",[ve]=ce(O),[be,Ne]=ve(O),Y=n.forwardRef((l,r)=>{const{__scopeSwitch:i,name:a,checked:o,defaultChecked:c,required:m,disabled:u,value:p="on",onCheckedChange:g,form:d,...R}=l,[v,b]=n.useState(null),T=J(r,S=>b(S)),h=n.useRef(!1),x=v?d||!!v.closest("form"):!0,[N,U]=ie({prop:o,defaultProp:c??!1,onChange:g,caller:O});return e.jsxs(be,{scope:i,checked:N,disabled:u,children:[e.jsx(W.button,{type:"button",role:"switch","aria-checked":N,"aria-required":m,"data-state":se(N),"data-disabled":u?"":void 0,disabled:u,value:p,...R,ref:T,onClick:le(l.onClick,S=>{U(z=>!z),x&&(h.current=S.isPropagationStopped(),h.current||S.stopPropagation())})}),x&&e.jsx(ee,{control:v,bubbles:!h.current,name:a,value:p,checked:N,required:m,disabled:u,form:d,style:{transform:"translateX(-100%)"}})]})});Y.displayName=O;var K="SwitchThumb",Z=n.forwardRef((l,r)=>{const{__scopeSwitch:i,...a}=l,o=Ne(K,i);return e.jsx(W.span,{"data-state":se(o.checked),"data-disabled":o.disabled?"":void 0,...a,ref:r})});Z.displayName=K;var Se="SwitchBubbleInput",ee=n.forwardRef(({__scopeSwitch:l,control:r,checked:i,bubbles:a=!0,...o},c)=>{const m=n.useRef(null),u=J(m,c),p=ge(i),g=oe(r);return n.useEffect(()=>{const d=m.current;if(!d)return;const R=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(R,"checked").set;if(p!==i&&b){const T=new Event("click",{bubbles:a});b.call(d,i),d.dispatchEvent(T)}},[p,i,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...o,tabIndex:-1,ref:u,style:{...o.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ee.displayName=Se;function se(l){return l?"checked":"unchecked"}var te=Y,ye=Z;const P=n.forwardRef(({className:l,...r},i)=>e.jsx(te,{className:V("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",l),...r,ref:i,children:e.jsx(ye,{className:V("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));P.displayName=te.displayName;function Ie(){const l=de();me();const[r,i]=n.useState({dailyXPGoal:100,grammarQuizQuestionCount:10,vocabularyQuestionCount:10,essayQuestionCount:10}),[a,o]=n.useState(f.getSettings()),[c,m]=n.useState(f.getPermissionStatus()),[u,p]=n.useState(!1),[g,d]=n.useState(!1),[R,v]=n.useState(H.getEnabled());n.useEffect(()=>{b(),p(f.isSupported()),m(f.getPermissionStatus())},[]);const b=()=>{const s=C.getAppSettings();i(s)},T=s=>{const j={...r,...s};i(j),C.saveAppSettings(j)},h=(s,j)=>{T({[s]:j})},x=(s,j)=>{const E={...a,[s]:j};o(E),f.updateSettings(E)},N=s=>{v(s),H.setEnabled(s),s&&H.sounds.click()},U=async()=>{try{const s=await f.requestPermission();m(s)}catch(s){console.error("Error requesting permission:",s),alert("通知の許可を取得できませんでした。ブラウザの設定を確認してください。")}},S=async()=>{if(c!=="granted"){alert("通知の許可が必要です。");return}d(!0);try{await f.testNotification()}catch(s){console.error("Error showing test notification:",s),alert("テスト通知の表示に失敗しました。")}finally{d(!1)}},Q=(()=>{switch(c){case"granted":return{text:"許可済み",color:"text-green-600",icon:fe};case"denied":return{text:"拒否済み",color:"text-red-600",icon:G};default:return{text:"未設定",color:"text-yellow-600",icon:$}}})(),ae=Q.icon,ne=()=>{confirm("すべての学習データを削除しますか？この操作は取り消せません。")&&confirm("本当に削除しますか？")&&(localStorage.clear(),window.location.reload())},re=()=>{try{const s={userStats:C.getUserStats(),learningHistory:C.getLearningHistory(),achievements:C.getAchievements(),vocabularyProgress:C.getVocabularyProgress(),appSettings:r,notificationSettings:a,exportDate:new Date().toISOString()},j=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),E=URL.createObjectURL(j),I=document.createElement("a");I.href=E,I.download=`entp-english-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(E)}catch(s){console.error("Error exporting data:",s),alert("データのエクスポートに失敗しました。")}};return e.jsx("div",{className:"min-h-screen p-4 flex flex-col justify-center",children:e.jsxs("div",{className:"max-w-md mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{variant:"ghost",onClick:()=>l("/"),className:"p-2",children:"←"}),e.jsx("h1",{className:"text-2xl font-bold",children:"アプリ設定"}),e.jsx("div",{className:"w-10"})]}),e.jsxs(y,{children:[e.jsxs(X,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),"学習設定"]}),e.jsx(A,{children:"学習目標をカスタマイズできます"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"1日のXP目標"}),e.jsxs(D,{value:r.dailyXPGoal.toString(),onValueChange:s=>h("dailyXPGoal",parseInt(s)),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(M,{children:[e.jsx(t,{value:"50",children:"50 XP"}),e.jsx(t,{value:"100",children:"100 XP"}),e.jsx(t,{value:"150",children:"150 XP"}),e.jsx(t,{value:"200",children:"200 XP"}),e.jsx(t,{value:"300",children:"300 XP"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ホーム画面の進捗バーに反映されます"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"文法クイズの問題数"}),e.jsxs(D,{value:r.grammarQuizQuestionCount.toString(),onValueChange:s=>h("grammarQuizQuestionCount",parseInt(s)),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(M,{children:[e.jsx(t,{value:"5",children:"5問"}),e.jsx(t,{value:"10",children:"10問"}),e.jsx(t,{value:"15",children:"15問"}),e.jsx(t,{value:"20",children:"20問"}),e.jsx(t,{value:"25",children:"25問"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"文法クイズで出題される問題数を設定します"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"語彙学習の問題数"}),e.jsxs(D,{value:r.vocabularyQuestionCount.toString(),onValueChange:s=>h("vocabularyQuestionCount",parseInt(s)),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(M,{children:[e.jsx(t,{value:"5",children:"5問"}),e.jsx(t,{value:"10",children:"10問"}),e.jsx(t,{value:"15",children:"15問"}),e.jsx(t,{value:"20",children:"20問"}),e.jsx(t,{value:"25",children:"25問"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"語彙学習で出題される問題数を設定します"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"英作文の問題数"}),e.jsxs(D,{value:r.essayQuestionCount.toString(),onValueChange:s=>h("essayQuestionCount",parseInt(s)),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(M,{children:[e.jsx(t,{value:"5",children:"5問"}),e.jsx(t,{value:"10",children:"10問"}),e.jsx(t,{value:"15",children:"15問"}),e.jsx(t,{value:"20",children:"20問"}),e.jsx(t,{value:"25",children:"25問"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"英作文で出題される問題数を設定します"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(k,{htmlFor:"sound-enabled",children:"効果音を有効にする"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"操作時の効果音を有効/無効にします"})]}),e.jsx(P,{id:"sound-enabled",checked:R,onCheckedChange:N})]})]})]}),e.jsxs(y,{children:[e.jsxs(X,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"データ管理"]}),e.jsx(A,{children:"学習データのバックアップと管理"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs(B,{onClick:re,variant:"outline",className:"w-full",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"データをエクスポート"]}),e.jsxs(B,{onClick:ne,variant:"destructive",className:"w-full",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"すべてのデータを削除"]})]})]}),u?e.jsxs(e.Fragment,{children:[e.jsxs(y,{children:[e.jsx(X,{children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"通知の許可状況"]})}),e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:`w-5 h-5 ${Q.color}`}),e.jsx("span",{className:Q.color,children:Q.text})]}),c!=="granted"&&e.jsx(B,{onClick:U,size:"sm",children:"許可をリクエスト"})]}),c==="denied"&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"通知が拒否されています。ブラウザの設定から許可してください。"})]})]}),e.jsxs(y,{children:[e.jsxs(X,{children:[e.jsx(_,{children:"通知設定"}),e.jsx(A,{children:"学習のリマインダーや実績通知を設定できます"})]}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(k,{htmlFor:"enable-notifications",children:"通知を有効にする"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"すべての通知機能を有効/無効にします"})]}),e.jsx(P,{id:"enable-notifications",checked:a.enabled,onCheckedChange:s=>x("enabled",s),disabled:c!=="granted"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(k,{htmlFor:"daily-reminder",children:"毎日の学習リマインダー"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"指定した時間に学習を促す通知を送信します"})]}),e.jsx(P,{id:"daily-reminder",checked:a.dailyReminder,onCheckedChange:s=>x("dailyReminder",s),disabled:!a.enabled||c!=="granted"})]}),a.dailyReminder&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(k,{htmlFor:"reminder-time",children:"通知時間"}),e.jsx(je,{id:"reminder-time",type:"time",value:a.reminderTime,onChange:s=>x("reminderTime",s.target.value),className:"w-32"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(k,{htmlFor:"streak-reminder",children:"連続学習記録通知"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"連続学習記録が更新された時に通知します"})]}),e.jsx(P,{id:"streak-reminder",checked:a.streakReminder,onCheckedChange:s=>x("streakReminder",s),disabled:!a.enabled||c!=="granted"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(k,{htmlFor:"achievement-reminder",children:"実績解除通知"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"新しい実績を獲得した時に通知します"})]}),e.jsx(P,{id:"achievement-reminder",checked:a.achievementReminder,onCheckedChange:s=>x("achievementReminder",s),disabled:!a.enabled||c!=="granted"})]})]})]}),e.jsx(y,{children:e.jsxs(w,{className:"pt-6",children:[e.jsxs(B,{onClick:S,disabled:c!=="granted"||g,className:"w-full",variant:"outline",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),g?"テスト中...":"テスト通知を送信"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center mt-2",children:"通知が正常に動作するかテストできます"})]})})]}):e.jsx(y,{children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"通知機能が利用できません"}),e.jsx("p",{className:"text-sm text-gray-600",children:"お使いのブラウザは通知機能をサポートしていません。"})]})})})]})})}export{Ie as default};
