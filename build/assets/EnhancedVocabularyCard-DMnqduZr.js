import{r as n,j as e}from"./ui-DhiIzcP4.js";import{C as v,d as R,a as f,B as h,b as W,P as J}from"./game-DQXwOTYN.js";import{g as K,I as O,H,j as Y,A as E,m as Z,n as _,p as ee,s as I,q as P}from"./learning-B7AfTcwU.js";import{c as se,f as te,s as ae,Q as ne}from"./index-BMpfVX6s.js";import"./vendor-D3F3s8fL.js";import"./progress-Dp2NNpON.js";function he({onBack:p,difficulty:T="beginner",category:re}){const[a,M]=n.useState([]),[c,S]=n.useState(0),[u,C]=n.useState({}),[y,Q]=n.useState(0),[U,A]=n.useState(!1),[le,k]=n.useState(0),[d]=n.useState(()=>K()),[g,X]=n.useState(d.getHeartSystem()),[w,q]=n.useState(d.getLevel()),[B]=n.useState(d.getStatusAllocation());n.useEffect(()=>{if(!d.consumeHeart()){alert("体力が不足しています。回復を待ってから再試行してください。"),p();return}L(),k(Date.now()),X(d.getHeartSystem()),I()},[]);const L=()=>{const l=O(T).map((s,N)=>({...se({id:N+1,japanese:s.meaning,correctAnswer:s.word,explanation:`${s.word}: ${s.meaning}`,choices:[s.word,s.word+"s",s.word+"ed",s.word+"ing"]},"basic-grammar","normal",w.level),word:s.word,meaning:s.meaning,example:s.example,exampleTranslation:s.exampleTranslation,skillField:"vocabulary"})),b=te(l,w.level,"vocabulary"),i=[],x=10;for(let s=0;s<x;s++){const N=b.filter(m=>!i.some(G=>G.id===m.id));if(N.length>0){const m=ae(N,B);m&&i.push(m)}}M(i)},r=a[c],D=(c+1)/a.length*100,$=t=>{C(l=>({...l,[c]:t}))},z=()=>{c<a.length-1?S(t=>t+1):V()},V=()=>{let t=0;a.forEach((i,x)=>{u[x]===i.word&&t++}),Q(t),A(!0);const l=ee(a.map((i,x)=>({questionId:i.id,answer:u[x]||"",isCorrect:u[x]===i.word})),r?.rank||"normal",!0),b=d.addXP(l);q(d.getLevel()),I(),b.leveledUp?P.sounds.levelUp():P.sounds.complete()},F=()=>{S(0),C({}),Q(0),A(!1),L(),k(Date.now())};if(U)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(v,{className:"mb-6",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"語彙学習結果"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5 text-red-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[g.current,"/",g.max]})]})]})}),e.jsx(f,{children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"text-4xl font-bold text-green-600",children:[y," / ",a.length]}),e.jsxs("div",{className:"text-lg text-gray-600",children:["正解率: ",Math.round(y/a.length*100),"%"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["獲得XP: ",a.reduce((t,l)=>t+l.xpReward,0)]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs(h,{onClick:F,className:"flex items-center",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"もう一度挑戦"]}),e.jsxs(h,{onClick:p,variant:"outline",className:"flex items-center",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"ホームに戻る"]})]})]})})]})})});if(!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(v,{children:e.jsx(f,{className:"p-8 text-center",children:e.jsx("div",{className:"text-lg text-gray-600",children:"問題を読み込み中..."})})})})});const o=u[c],j=o===r.word;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(v,{className:"mb-6",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(h,{onClick:p,variant:"outline",size:"sm",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"戻る"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"語彙学習"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5 text-red-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[g.current,"/",g.max]})]}),e.jsxs(W,{variant:"secondary",children:["Level ",w.level]})]})]})}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["問題 ",c+1,"/",a.length]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[c+1," / ",a.length]})]}),e.jsx(J,{value:D,className:"h-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["スコア: ",y," / ",a.length]}),e.jsx(ne,{rank:r.rank,showXP:!0,question:r,size:"sm"})]})]})})]}),e.jsx(v,{className:"mb-6",children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:r.meaning}),e.jsx("p",{className:"text-sm text-gray-600",children:"この意味の英単語を選択してください"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:r.options.map((t,l)=>e.jsx(h,{onClick:()=>$(t),variant:o===t?"default":"outline",className:`h-16 text-lg ${o===t?j?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600":""}`,children:t},l))}),o&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:`flex items-center justify-center space-x-2 ${j?"text-green-600":"text-red-600"}`,children:[j?e.jsx(Z,{className:"w-6 h-6"}):e.jsx(_,{className:"w-6 h-6"}),e.jsx("span",{className:"text-lg font-medium",children:j?"正解！":"不正解"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-800 mb-2",children:"例文"}),e.jsx("p",{className:"text-gray-700 mb-2",children:r.example}),e.jsx("p",{className:"text-sm text-gray-600",children:r.exampleTranslation})]})]})]})})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(h,{onClick:z,size:"lg",disabled:!o,children:c<a.length-1?"次の問題":"答え合わせ"})})]})})}export{he as EnhancedVocabularyCard};
