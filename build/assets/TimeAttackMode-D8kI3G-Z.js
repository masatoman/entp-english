import{r as a,j as e}from"./ui-C48fKjuK.js";import{B as c,C as u,a as f,P as q,c as B,f as G}from"./game-DhYA9e1X.js";import{a as H}from"./index-NpZQEt4n.js";import{A as S,d as O,F as V,Z as X,a as J,y as K}from"./learning-CJqkZPhv.js";import{D as U}from"./progress-Bh7B1qMw.js";import"./vendor-D3F3s8fL.js";function ne({onBack:x}){const[h,D]=a.useState([]),[r,A]=a.useState(0),[i,g]=a.useState(0),[d,M]=a.useState(0),[N,p]=a.useState(0),[L,Q]=a.useState(0),[j,k]=a.useState(!1),[b,I]=a.useState(!1),[R,T]=a.useState(""),[w,v]=a.useState(!1),[y,$]=a.useState(!1),z=()=>{const s=[];H("basic-grammar","easy").slice(0,5).forEach(t=>{s.push({id:t.id,type:"grammar",question:t.japanese,options:t.choices,correctAnswer:t.correctAnswer,explanation:t.explanation,timeLimit:15})});const l=K("beginner","all").slice(0,5);return l.forEach((t,m)=>{s.push({id:1e3+m,type:"vocabulary",question:`「${t.japanese}」を英語で言うと？`,options:[t.word,l[(m+1)%l.length].word,l[(m+2)%l.length].word,l[(m+3)%l.length].word].sort(()=>Math.random()-.5),correctAnswer:t.word,explanation:t.meaning,timeLimit:10})}),s.sort(()=>Math.random()-.5)},E=()=>{const s=z();D(s),A(0),M(0),p(0),Q(0),k(!0),I(!1),v(!1),s.length>0&&g(s[0].timeLimit)};a.useEffect(()=>{if(!j||b)return;const s=setInterval(()=>{g(n=>n<=1?(P(""),0):n-1)},1e3);return()=>clearInterval(s)},[j,b]);const P=s=>{if(!j||w)return;const n=h[r],l=s===n.correctAnswer;if($(l),v(!0),l){const t=N+1;p(t),Q(C=>Math.max(C,t));const m=100,W=Math.min(t*10,100),Z=Math.max(i*2,0);M(C=>C+m+W+Z)}else p(0);setTimeout(()=>{r+1>=h.length?(I(!0),k(!1),F()):(A(t=>t+1),g(h[r+1].timeLimit),v(!1),T(""))},2e3)},F=()=>{const s=Math.floor(d/10),n={date:new Date().toISOString().split("T")[0],type:"time-attack",score:d,maxCombo:L,questionsAnswered:r+1,xpEarned:s,duration:0};U.recordLearningSession(n)},o=h[r];return b?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-orange-50",children:e.jsxs("div",{className:"max-w-md mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",onClick:x,className:"p-2",children:e.jsx(S,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:"タイムアタック結果"}),e.jsx("div",{className:"w-10"})]}),e.jsx(u,{className:"text-center border-0 shadow-lg bg-gradient-to-br from-yellow-50 to-orange-50",children:e.jsxs(f,{className:"p-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🏆"}),e.jsx("h2",{className:"text-3xl font-bold text-orange-800 mb-2",children:"タイムアタック完了！"}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"スコア"}),e.jsx("span",{className:"text-2xl font-bold text-orange-600",children:d.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"最大コンボ"}),e.jsx("span",{className:"text-2xl font-bold text-red-600",children:L})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"正解数"}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:r+1})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"獲得XP"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:Math.floor(d/10)})]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx(c,{onClick:E,className:"w-full",size:"lg",children:"もう一度挑戦"}),e.jsx(c,{onClick:x,variant:"outline",className:"w-full",children:"ホームに戻る"})]})]})})]})}):j?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-orange-50",children:e.jsxs("div",{className:"max-w-md mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",onClick:x,className:"p-2",children:e.jsx(S,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:"タイムアタック"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"スコア"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:d.toLocaleString()})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"コンボ"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:N})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"問題"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[r+1,"/10"]})]})]}),e.jsx(u,{className:"border-0 shadow-lg",children:e.jsxs(f,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:"残り時間"}),e.jsx("span",{className:`text-2xl font-bold ${i<=5?"text-red-600":"text-blue-600"}`,children:i})]}),e.jsx(q,{value:i/o.timeLimit*100,className:`h-2 ${i<=5?"bg-red-200":"bg-blue-200"}`})]})}),o&&e.jsxs(u,{className:"border-0 shadow-lg",children:[e.jsx(B,{children:e.jsx(G,{className:"text-center",children:o.type==="grammar"?"文法問題":"単語問題"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg text-center",children:e.jsx("p",{className:"text-lg",children:o.question})}),w&&e.jsxs("div",{className:`p-4 rounded-lg text-center ${y?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("p",{className:"font-bold text-lg",children:y?"正解！":"不正解"}),y&&e.jsxs("p",{className:"text-sm mt-1",children:["+",100+Math.min(N*10,100)+Math.max(i*2,0)," ポイント"]})]}),!w&&o.options&&e.jsx("div",{className:"space-y-2",children:o.options.map((s,n)=>e.jsxs(c,{variant:R===s?"default":"outline",className:"w-full justify-start h-auto p-3 text-left",onClick:()=>{T(s),P(s)},children:[String.fromCharCode(65+n),". ",s]},n))})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-orange-50",children:e.jsxs("div",{className:"max-w-md mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",onClick:x,className:"p-2",children:e.jsx(S,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:"タイムアタック"}),e.jsx("div",{className:"w-10"})]}),e.jsx(u,{className:"text-center border-0 shadow-lg bg-gradient-to-br from-red-50 to-orange-50",children:e.jsxs(f,{className:"p-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚡"}),e.jsx("h2",{className:"text-2xl font-bold text-red-800 mb-4",children:"タイムアタックモード"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"制限時間内に連続で正解を重ねて高スコアを目指そう！"}),e.jsxs("div",{className:"space-y-3 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{children:"各問題に制限時間あり"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{children:"連続正解でコンボボーナス"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{children:"残り時間でタイムボーナス"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"10問連続で挑戦"})]})]}),e.jsx(c,{onClick:E,className:"w-full mt-8",size:"lg",children:"スタート！"})]})})]})})}export{ne as TimeAttackMode};
