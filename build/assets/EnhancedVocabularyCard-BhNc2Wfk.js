import{r,j as e}from"./ui-C48fKjuK.js";import{C as f,c as R,a as v,B as h,P as W}from"./game-DhYA9e1X.js";import{g as J,H,f as K,A as E,h as O,i as Y,j as P}from"./learning-CJqkZPhv.js";import{g as Z,Q as _,c as ee,s as T}from"./index-NpZQEt4n.js";import{c as se,f as te,s as ae}from"./questionAdapter-qfrWA0Uz.js";import"./vendor-D3F3s8fL.js";import"./progress-Bh7B1qMw.js";function he({onBack:p,difficulty:I="beginner",category:re}){const[a,M]=r.useState([]),[i,S]=r.useState(0),[u,C]=r.useState({}),[y,Q]=r.useState(0),[U,A]=r.useState(!1),[ne,L]=r.useState(0),[o]=r.useState(()=>Z()),[g,X]=r.useState(o.getHeartSystem()),[w,B]=r.useState(o.getLevel()),[D]=r.useState(o.getStatusAllocation());r.useEffect(()=>{if(!o.consumeHeart()){alert("体力が不足しています。回復を待ってから再試行してください。"),p();return}k(),L(Date.now()),X(o.getHeartSystem()),T()},[]);const k=()=>{const l=J(I).map((s,N)=>({...se({id:N+1,japanese:s.meaning,correctAnswer:s.word,explanation:`${s.word}: ${s.meaning}`,choices:[s.word,s.word+"s",s.word+"ed",s.word+"ing"]},"basic-grammar","normal",w.level),word:s.word,meaning:s.meaning,example:s.example,exampleTranslation:s.exampleTranslation,skillField:"vocabulary"})),b=te(l,w.level,"vocabulary"),c=[],d=10;for(let s=0;s<d;s++){const N=b.filter(m=>!c.some(G=>G.id===m.id));if(N.length>0){const m=ae(N,D);m&&c.push(m)}}M(c)},n=a[i],$=(i+1)/a.length*100,q=t=>{C(l=>({...l,[i]:t}))},z=()=>{i<a.length-1?S(t=>t+1):V()},V=()=>{let t=0;a.forEach((c,d)=>{u[d]===c.word&&t++}),Q(t),A(!0);const l=ee(a.map((c,d)=>({questionId:c.id,answer:u[d]||"",isCorrect:u[d]===c.word})),n?.rank||"normal",!0),b=o.addXP(l);B(o.getLevel()),T(),b.leveledUp?P.playLevelUpSound():P.playCompletionSound()},F=()=>{S(0),C({}),Q(0),A(!1),k(),L(Date.now())};if(U)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(f,{className:"mb-6",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"語彙学習結果"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5 text-red-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[g.current,"/",g.max]})]})]})}),e.jsx(v,{children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"text-4xl font-bold text-green-600",children:[y," / ",a.length]}),e.jsxs("div",{className:"text-lg text-gray-600",children:["正解率: ",Math.round(y/a.length*100),"%"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["獲得XP: ",a.reduce((t,l)=>t+l.xpReward,0)]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs(h,{onClick:F,className:"flex items-center",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"もう一度挑戦"]}),e.jsxs(h,{onClick:p,variant:"outline",className:"flex items-center",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"ホームに戻る"]})]})]})})]})})});if(!n)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(f,{children:e.jsx(v,{className:"p-8 text-center",children:e.jsx("div",{className:"text-lg text-gray-600",children:"問題を読み込み中..."})})})})});const x=u[i],j=x===n.word;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(f,{className:"mb-6",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(h,{onClick:p,variant:"outline",size:"sm",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"戻る"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"語彙学習"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5 text-red-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[g.current,"/",g.max]})]}),e.jsxs(Badge,{variant:"secondary",children:["Level ",w.level]})]})]})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"進捗"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[i+1," / ",a.length]})]}),e.jsx(W,{value:$,className:"h-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["スコア: ",y," / ",a.length]}),e.jsx(_,{rank:n.rank,showXP:!0,question:n,size:"sm"})]})]})})]}),e.jsx(f,{className:"mb-6",children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:n.meaning}),e.jsx("p",{className:"text-sm text-gray-600",children:"この意味の英単語を選択してください"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:n.options.map((t,l)=>e.jsx(h,{onClick:()=>q(t),variant:x===t?"default":"outline",className:`h-16 text-lg ${x===t?j?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600":""}`,children:t},l))}),x&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:`flex items-center justify-center space-x-2 ${j?"text-green-600":"text-red-600"}`,children:[j?e.jsx(O,{className:"w-6 h-6"}):e.jsx(Y,{className:"w-6 h-6"}),e.jsx("span",{className:"text-lg font-medium",children:j?"正解！":"不正解"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-800 mb-2",children:"例文"}),e.jsx("p",{className:"text-gray-700 mb-2",children:n.example}),e.jsx("p",{className:"text-sm text-gray-600",children:n.exampleTranslation})]})]})]})})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(h,{onClick:z,size:"lg",disabled:!x,children:i<a.length-1?"次の問題":"答え合わせ"})})]})})}export{he as EnhancedVocabularyCard};
