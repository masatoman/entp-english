const l={"basic-grammar":"grammar",tenses:"grammar",modals:"grammar",passive:"grammar",relative:"grammar",subjunctive:"grammar",comparison:"grammar",participle:"grammar",infinitive:"grammar"},f={normal:{min:3,max:8},rare:{min:10,max:18},epic:{min:25,max:40},legendary:{min:50,max:100}};function s(n){if(n<=20){const r=Math.random();return r<.8?"normal":r<.98?"rare":"epic"}else if(n<=40){const r=Math.random();return r<.6?"normal":r<.9?"rare":r<.99?"epic":"legendary"}else if(n<=60){const r=Math.random();return r<.4?"normal":r<.75?"rare":r<.95?"epic":"legendary"}else if(n<=80){const r=Math.random();return r<.25?"normal":r<.6?"rare":r<.9?"epic":"legendary"}else{const r=Math.random();return r<.15?"normal":r<.45?"rare":r<.8?"epic":"legendary"}}function u(n,r=!1){const e=f[n],t=Math.floor(Math.random()*(e.max-e.min+1))+e.min;return r?Math.floor(t*1.5):t}function g(n,r,e,t){const o=s(t),i=l[r],a=u(o);return{id:n.id,question:n.japanese,options:n.choices,correctAnswer:n.correctAnswer,explanation:n.explanation,category:r,difficulty:e,rank:o,skillField:i,xpReward:a}}function h(n,r,e){return n.filter(t=>{if(e&&t.skillField!==e)return!1;const i=["normal","rare","epic","legendary"].indexOf(t.rank);return i>=i})}function p(n,r){if(n.length===0)return null;const e=n.map(a=>{const m=r[a.skillField]/30,c=d(a.rank);return m*c}),t=e.reduce((a,m)=>a+m,0);if(t===0)return n[Math.floor(Math.random()*n.length)];const o=Math.random()*t;let i=0;for(let a=0;a<n.length;a++)if(i+=e[a],o<=i)return n[a];return n[0]}function d(n){return{normal:1,rare:2,epic:3,legendary:5}[n]}export{g as c,h as f,p as s};
