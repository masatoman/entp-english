import{r as i,u as J,w as ie,j as e,f as ce,d as W,h as le,z as oe}from"./ui-iDNYoGPn.js";import{u as de,b as me,B,C as N,f as D,h as X,j as A,d as S}from"./game-DNOgwd-m.js";import{D as y}from"./progress-D2o6Jopk.js";import{notificationManager as p}from"./notificationManager-DRqVOwDk.js";import{q,i as H,a as he,$ as V,a0 as ue,a1 as $,p as xe,I as je,a2 as pe,a3 as G,C as fe}from"./learning-CAFcT4jp.js";import{u as ge,b as _,c as L,d as F,e as M,f as t,L as w}from"./index--0uh6uKU.js";import"./vendor-D3F3s8fL.js";var O="Switch",[ve]=ce(O),[be,Ne]=ve(O),K=i.forwardRef((c,o)=>{const{__scopeSwitch:n,name:d,checked:a,defaultChecked:k,required:r,disabled:m,value:x="on",onCheckedChange:P,form:h,...f}=c,[g,v]=i.useState(null),R=J(o,b=>v(b)),T=i.useRef(!1),j=g?h||!!g.closest("form"):!0,[l,U]=ie({prop:a,defaultProp:k??!1,onChange:P,caller:O});return e.jsxs(be,{scope:n,checked:l,disabled:m,children:[e.jsx(W.button,{type:"button",role:"switch","aria-checked":l,"aria-required":r,"data-state":se(l),"data-disabled":m?"":void 0,disabled:m,value:x,...f,ref:R,onClick:le(c.onClick,b=>{U(z=>!z),j&&(T.current=b.isPropagationStopped(),T.current||b.stopPropagation())})}),j&&e.jsx(ee,{control:g,bubbles:!T.current,name:d,value:x,checked:l,required:r,disabled:m,form:h,style:{transform:"translateX(-100%)"}})]})});K.displayName=O;var Y="SwitchThumb",Z=i.forwardRef((c,o)=>{const{__scopeSwitch:n,...d}=c,a=Ne(Y,n);return e.jsx(W.span,{"data-state":se(a.checked),"data-disabled":a.disabled?"":void 0,...d,ref:o})});Z.displayName=Y;var Se="SwitchBubbleInput",ee=i.forwardRef(({__scopeSwitch:c,control:o,checked:n,bubbles:d=!0,...a},k)=>{const r=i.useRef(null),m=J(r,k),x=ge(n),P=oe(o);return i.useEffect(()=>{const h=r.current;if(!h)return;const f=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(f,"checked").set;if(x!==n&&v){const R=new Event("click",{bubbles:d});v.call(h,n),h.dispatchEvent(R)}},[x,n,d]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...a,tabIndex:-1,ref:m,style:{...a.style,...P,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ee.displayName=Se;function se(c){return c?"checked":"unchecked"}var te=K,ye=Z;const C=i.forwardRef(({className:c,...o},n)=>e.jsx(te,{className:q("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",c),...o,ref:n,children:e.jsx(ye,{className:q("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));C.displayName=te.displayName;function Be({onBack:c}){const o=de();me();const[n,d]=i.useState({dailyXPGoal:100,grammarQuizQuestionCount:10,vocabularyQuestionCount:10,essayQuestionCount:10}),[a,k]=i.useState(p.getSettings()),[r,m]=i.useState(p.getPermissionStatus()),[x,P]=i.useState(!1),[h,f]=i.useState(!1),[g,v]=i.useState(H.getEnabled());i.useEffect(()=>{R(),P(p.isSupported()),m(p.getPermissionStatus())},[]);const R=()=>{const s=y.getAppSettings();d(s)},T=s=>{const u={...n,...s};d(u),y.saveAppSettings(u)},j=(s,u)=>{T({[s]:u})},l=(s,u)=>{const E={...a,[s]:u};k(E),p.updateSettings(E)},U=s=>{v(s),H.setEnabled(s),s&&H.sounds.click()},b=async()=>{try{const s=await p.requestPermission();m(s)}catch(s){console.error("Error requesting permission:",s),alert("通知の許可を取得できませんでした。ブラウザの設定を確認してください。")}},z=async()=>{if(r!=="granted"){alert("通知の許可が必要です。");return}f(!0);try{await p.testNotification()}catch(s){console.error("Error showing test notification:",s),alert("テスト通知の表示に失敗しました。")}finally{f(!1)}},Q=(()=>{switch(r){case"granted":return{text:"許可済み",color:"text-green-600",icon:fe};case"denied":return{text:"拒否済み",color:"text-red-600",icon:G};default:return{text:"未設定",color:"text-yellow-600",icon:$}}})(),ae=Q.icon,ne=()=>{confirm("すべての学習データを削除しますか？この操作は取り消せません。")&&confirm("本当に削除しますか？")&&(localStorage.clear(),window.location.reload())},re=()=>{try{const s={userStats:y.getUserStats(),learningHistory:y.getLearningHistory(),achievements:y.getAchievements(),vocabularyProgress:y.getVocabularyProgress(),appSettings:n,notificationSettings:a,exportDate:new Date().toISOString()},u=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),E=URL.createObjectURL(u),I=document.createElement("a");I.href=E,I.download=`entp-english-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(E)}catch(s){console.error("Error exporting data:",s),alert("データのエクスポートに失敗しました。")}};return e.jsx("div",{className:"min-h-screen p-4 flex flex-col justify-center",children:e.jsxs("div",{className:"max-w-md mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{variant:"ghost",onClick:()=>o("/"),className:"p-2",children:"←"}),e.jsx("h1",{className:"text-2xl font-bold",children:"アプリ設定"}),e.jsx("div",{className:"w-10"})]}),e.jsxs(N,{children:[e.jsxs(D,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),"学習設定"]}),e.jsx(A,{children:"学習目標をカスタマイズできます"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"1日のXP目標"}),e.jsxs(_,{value:n.dailyXPGoal.toString(),onValueChange:s=>j("dailyXPGoal",parseInt(s)),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(M,{children:[e.jsx(t,{value:"50",children:"50 XP"}),e.jsx(t,{value:"100",children:"100 XP"}),e.jsx(t,{value:"150",children:"150 XP"}),e.jsx(t,{value:"200",children:"200 XP"}),e.jsx(t,{value:"300",children:"300 XP"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ホーム画面の進捗バーに反映されます"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"文法クイズの問題数"}),e.jsxs(_,{value:n.grammarQuizQuestionCount.toString(),onValueChange:s=>j("grammarQuizQuestionCount",parseInt(s)),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(M,{children:[e.jsx(t,{value:"5",children:"5問"}),e.jsx(t,{value:"10",children:"10問"}),e.jsx(t,{value:"15",children:"15問"}),e.jsx(t,{value:"20",children:"20問"}),e.jsx(t,{value:"25",children:"25問"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"文法クイズで出題される問題数を設定します"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"語彙学習の問題数"}),e.jsxs(_,{value:n.vocabularyQuestionCount.toString(),onValueChange:s=>j("vocabularyQuestionCount",parseInt(s)),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(M,{children:[e.jsx(t,{value:"5",children:"5問"}),e.jsx(t,{value:"10",children:"10問"}),e.jsx(t,{value:"15",children:"15問"}),e.jsx(t,{value:"20",children:"20問"}),e.jsx(t,{value:"25",children:"25問"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"語彙学習で出題される問題数を設定します"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"英作文の問題数"}),e.jsxs(_,{value:n.essayQuestionCount.toString(),onValueChange:s=>j("essayQuestionCount",parseInt(s)),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(M,{children:[e.jsx(t,{value:"5",children:"5問"}),e.jsx(t,{value:"10",children:"10問"}),e.jsx(t,{value:"15",children:"15問"}),e.jsx(t,{value:"20",children:"20問"}),e.jsx(t,{value:"25",children:"25問"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"英作文で出題される問題数を設定します"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(w,{htmlFor:"sound-enabled",children:"効果音を有効にする"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"操作時の効果音を有効/無効にします"})]}),e.jsx(C,{id:"sound-enabled",checked:g,onCheckedChange:U})]})]})]}),e.jsxs(N,{children:[e.jsxs(D,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"データ管理"]}),e.jsx(A,{children:"学習データのバックアップと管理"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs(B,{onClick:re,variant:"outline",className:"w-full",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"データをエクスポート"]}),e.jsxs(B,{onClick:ne,variant:"destructive",className:"w-full",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"すべてのデータを削除"]})]})]}),x?e.jsxs(e.Fragment,{children:[e.jsxs(N,{children:[e.jsx(D,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"通知の許可状況"]})}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:`w-5 h-5 ${Q.color}`}),e.jsx("span",{className:Q.color,children:Q.text})]}),r!=="granted"&&e.jsx(B,{onClick:b,size:"sm",children:"許可をリクエスト"})]}),r==="denied"&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"通知が拒否されています。ブラウザの設定から許可してください。"})]})]}),e.jsxs(N,{children:[e.jsxs(D,{children:[e.jsx(X,{children:"通知設定"}),e.jsx(A,{children:"学習のリマインダーや実績通知を設定できます"})]}),e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(w,{htmlFor:"enable-notifications",children:"通知を有効にする"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"すべての通知機能を有効/無効にします"})]}),e.jsx(C,{id:"enable-notifications",checked:a.enabled,onCheckedChange:s=>l("enabled",s),disabled:r!=="granted"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(w,{htmlFor:"daily-reminder",children:"毎日の学習リマインダー"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"指定した時間に学習を促す通知を送信します"})]}),e.jsx(C,{id:"daily-reminder",checked:a.dailyReminder,onCheckedChange:s=>l("dailyReminder",s),disabled:!a.enabled||r!=="granted"})]}),a.dailyReminder&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(w,{htmlFor:"reminder-time",children:"通知時間"}),e.jsx(je,{id:"reminder-time",type:"time",value:a.reminderTime,onChange:s=>l("reminderTime",s.target.value),className:"w-32"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(w,{htmlFor:"streak-reminder",children:"連続学習記録通知"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"連続学習記録が更新された時に通知します"})]}),e.jsx(C,{id:"streak-reminder",checked:a.streakReminder,onCheckedChange:s=>l("streakReminder",s),disabled:!a.enabled||r!=="granted"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(w,{htmlFor:"achievement-reminder",children:"実績解除通知"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"新しい実績を獲得した時に通知します"})]}),e.jsx(C,{id:"achievement-reminder",checked:a.achievementReminder,onCheckedChange:s=>l("achievementReminder",s),disabled:!a.enabled||r!=="granted"})]})]})]}),e.jsx(N,{children:e.jsxs(S,{className:"pt-6",children:[e.jsxs(B,{onClick:z,disabled:r!=="granted"||h,className:"w-full",variant:"outline",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),h?"テスト中...":"テスト通知を送信"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center mt-2",children:"通知が正常に動作するかテストできます"})]})})]}):e.jsx(N,{children:e.jsx(S,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"通知機能が利用できません"}),e.jsx("p",{className:"text-sm text-gray-600",children:"お使いのブラウザは通知機能をサポートしていません。"})]})})})]})})}export{Be as AppSettings};
